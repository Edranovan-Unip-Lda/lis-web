 @if (!isSuccess) {
 <div class="w-full" style="background: var(--surface-ground)">
     <p-fluid class="text-center w-full flex items-center md:items-center flex-col bg-auto md:bg-contain !bg-no-repeat"
         style="padding: 2% 10% 2% 10%; background: var(--exception-pages-image); background-size: contain;">
         <div class="flex flex-col">
             <div class="flex items-center justify-center">
                 <img src="/images/logo.png" style="width:85px" alt="mci-logo" />
             </div>
             <div class="mt-2 mb-8">
                 <p class="text-xl">
                     Trade License Management System
                 </p>
             </div>
         </div>
     </p-fluid>


     <div class="w-full px-8" style="background: var(--surface-ground)">
         <p-stepper [value]="1" class="basis-[50rem]" [linear]="false">
             <p-step-list>
                 <p-step [value]="1">Empresa</p-step>
                 <p-step [value]="2">Proprietário(a) / Titular da empresa</p-step>
                 <p-step [value]="3">Conta de Acesso</p-step>
                 <p-step [value]="4">Confirmação</p-step>
             </p-step-list>
             <p-step-panels>
                 <p-step-panel [value]="1">
                     <ng-template #content let-activateCallback="activateCallback">
                         <form [formGroup]="empresaForm">
                             <div class="grid grid-cols-12 gap-4">
                                 <div class="mb-6 col-span-12">
                                     <label for="nome"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Nome da Empresa
                                     </label>
                                     <input formControlName="nome" id="nome" type="text" pInputText fluid />
                                 </div>
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="sede"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Sede
                                     </label>
                                     <input formControlName="sede" id="sede" type="text" pInputText fluid />
                                 </div>
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="sociedadeComercial"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Tipo de Sociedade Comercial
                                     </label>
                                     <p-select fluid formControlName="sociedadeComercial"
                                         [options]="listaSociedadeComercial" optionLabel="nome"
                                         placeholder="Selecione o tipo de sociedade" [showClear]="true">
                                     </p-select>
                                 </div>
                             </div>
                             <div class="flex flex-col gap-6 w-full sm:w-auto mb-6">
                                 <div class="flex flex-col sm:flex-row sm:items-center gap-6">
                                     <div class="flex-auto">
                                         <label for="aldeia"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Aldeia
                                         </label>
                                         <p-select fluid formControlName="aldeia" [options]="aldeias" optionLabel="nome"
                                             placeholder="Selecione a Aldeia" [filter]="true" filterBy="nome"
                                             [showClear]="true" (onFilter)="aldeiaFilter($event)"
                                             (onpanelHide)="onPanelHide()" (onClear)="onPanelHide()">
                                         </p-select>
                                     </div>
                                     <div class="flex-auto">
                                         <label for="suco"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Suco
                                         </label>
                                         <input formControlName="suco" id="suco" type="text" pInputText fluid />
                                     </div>

                                     <div class="flex-auto">
                                         <label for="posto"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Posto Administrativo
                                         </label>
                                         <input formControlName="postoAdministrativo" id="postoAdministrativo"
                                             type="text" pInputText fluid />
                                     </div>
                                     <div class="flex-auto">
                                         <label for="municipio"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Municipio
                                         </label>
                                         <input formControlName="municipio" id="municipio" type="text" pInputText
                                             fluid />
                                     </div>

                                 </div>
                             </div>
                             <div class="grid grid-cols-12 gap-4">
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="nif"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         NIF da Empresa
                                     </label>
                                     <input formControlName="nif" id="nif" type="text" pInputText fluid />
                                 </div>
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="numeroRegistoComercial"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Nº Registo Comercial
                                     </label>
                                     <input formControlName="numeroRegistoComercial" id="numeroRegistoComercial"
                                         type="text" pInputText fluid />
                                 </div>
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="capitalSocial"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Capital Social
                                     </label>
                                     <p-inputgroup>
                                         <p-inputgroup-addon>$</p-inputgroup-addon>
                                         <p-inputnumber formControlName="capitalSocial" mode="decimal"
                                             [minFractionDigits]="2" [maxFractionDigits]="2" />
                                     </p-inputgroup>
                                 </div>
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="dataRegisto"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Data de Registo
                                     </label>
                                     <p-date-picker formControlName="dataRegisto" id="dataRegisto" [showIcon]="true"
                                         [showButtonBar]="true" fluid dateFormat="dd/mm/yy" inputStyleClass="w-full" />
                                 </div>
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="telefone"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Nº Telefone
                                     </label>
                                     <input formControlName="telefone" id="telefone" type="tel" pInputText fluid />
                                 </div>
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="telemovel"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Nº Telemóvel
                                     </label>
                                     <input formControlName="telemovel" id="telemovel" type="tel" pInputText fluid />
                                 </div>
                             </div>
                         </form>
                         <div class="flex pt-6 justify-between">
                             <span class="font-medium text-surface-600 dark:text-surface-200">Já tem conta? <a
                                     [routerLink]="['/auth/login']"
                                     class="font-semibold cursor-pointer text-surface-900 dark:text-surface-0 hover:text-primary transition-colors duration-300">Entrar</a></span>
                             <p-button [disabled]="disableStepEmpresa()" label="Continuar" icon="pi pi-arrow-right"
                                 iconPos="right" (onClick)="activateCallback(2)" />
                         </div>
                     </ng-template>
                 </p-step-panel>

                 <p-step-panel [value]="2">
                     <ng-template #content let-activateCallback="activateCallback">
                         <form [formGroup]="empresaForm" class="px-8">
                             <div class="grid grid-cols-12 gap-4">
                                 <div class="mb-6 col-span-12">
                                     <label for="tipoPropriedade"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Tipo propetário
                                     </label>
                                     <p-select fluid formControlName="tipoPropriedade" [options]="tipoProriedadeOpts"
                                         optionLabel="name" placeholder="Selecione o tipo" [showClear]="true">
                                     </p-select>
                                 </div>
                             </div>

                             <div formArrayName="acionistas">
                                 @for (item of acionistasArray.controls; track $index) {
                                 @if (acionistasArray.length > 1) {
                                 <div class="text-2xl mt-6 mb-6">
                                     <span class="mr-6">{{ item.get('sectionTitle')?.value }}</span>
                                     <p-button size="small" severity="warn" pTooltip="Eliminar acionista"
                                         tooltipPosition="right" icon="pi pi-user-minus" iconPos="left" [rounded]="true"
                                         (onClick)="removeAcionistaForm($index)" />
                                 </div>
                                 }
                                 <div class="grid grid-cols-12 gap-4" [formGroupName]="$index">
                                     <div class="mb-6 col-span-12">
                                         <label for="nome"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Nome
                                         </label>
                                         <input formControlName="nome" id="nome" type="text" pInputText fluid />
                                     </div>
                                     <div class="mb-6 col-span-12 md:col-span-6">
                                         <label for="acoes"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Ações
                                         </label>
                                         <p-inputgroup>
                                             <p-inputgroup-addon>%</p-inputgroup-addon>
                                             <p-inputnumber formControlName="acoes" mode="decimal" [max]="100"
                                                 [minFractionDigits]="2" [maxFractionDigits]="2" />
                                         </p-inputgroup>
                                     </div>
                                     <div class="mb-6 col-span-12 md:col-span-6">
                                         <label for="nif"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             NIF
                                         </label>
                                         <input formControlName="nif" id="nif" type="text" pInputText fluid />
                                     </div>
                                     <div class="mb-6 col-span-12 md:col-span-6">
                                         <label for="tipoDocumento"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Tipo Documento
                                         </label>
                                         <p-select fluid formControlName="tipoDocumento" [options]="tipoDocumentoOpts"
                                             optionLabel="name" placeholder="Selecione o tipo documento"
                                             [showClear]="true">
                                         </p-select>
                                     </div>
                                     <div class="mb-6 col-span-12 md:col-span-6">
                                         <label for="numeroDocumento"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Nº Documento
                                         </label>
                                         <input formControlName="numeroDocumento" id="numeroDocumento" type="text"
                                             pInputText fluid />
                                     </div>
                                     <div class="mb-6 col-span-12 md:col-span-6">
                                         <label for="telefone"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Nº Telefone
                                         </label>
                                         <input formControlName="telefone" id="telefone" type="tel" pInputText fluid />
                                     </div>
                                     <div class="mb-6 col-span-12 md:col-span-6">
                                         <label for="email"
                                             class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                             Email
                                         </label>
                                         <input formControlName="email" id="email" type="email" pInputText fluid />
                                     </div>
                                 </div>
                                 @if (acionistasArray.length > 1) {
                                 <p-divider />
                                 }
                                 }
                             </div>
                             @if(showAddBtnAcionistas) {
                             <p-button label="Adicionar acionista" icon="pi pi-user-plus" iconPos="left"
                                 (onClick)="addAcionistaForm()" />
                             }
                         </form>
                         <div class="flex pt-6 justify-between">
                             <p-button label="Back" severity="secondary" icon="pi pi-arrow-left" iconPos="left"
                                 (onClick)="activateCallback(1)" />
                             <p-button [disabled]="disableStepProprietario()" label="Continuar" icon="pi pi-arrow-right"
                                 iconPos="right" (onClick)="activateCallback(3)" />
                         </div>
                     </ng-template>
                 </p-step-panel>

                 <p-step-panel [value]="3">
                     <ng-template #content let-activateCallback="activateCallback">
                         <form [formGroup]="empresaForm" class="px-8">
                             <div formGroupName="utilizador" class="grid grid-cols-12 gap-4">

                                 <div class="mb-6 col-span-12">
                                     <label for="gerente"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Gerente
                                     </label>
                                     <input formControlName="gerente" id="gerente" type="text" pInputText fluid
                                         placeholder="Ex: Joao da Silva" />
                                 </div>
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="email"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Email
                                     </label>
                                     <input formControlName="email" id="email" type="email" pInputText fluid />
                                 </div>
                                 <div class="mb-6 col-span-12 md:col-span-6">
                                     <label for="password"
                                         class="font-medium text-surface-900 dark:text-surface-0 mb-2 block">
                                         Palavra-passe
                                     </label>
                                     <p-password formControlName="password" fluid [feedback]="true"
                                         [toggleMask]="true" />
                                 </div>
                             </div>
                             <div class="mt-6 mb-6 text-left flex justify-between">
                                 <p-button label="Back" severity="secondary" icon="pi pi-arrow-left" iconPos="left"
                                     (onClick)="activateCallback(2)" />
                                 <p-button [disabled]="disableStepConta()" label="Continuar" icon="pi pi-arrow-right"
                                     iconPos="right" (onClick)="activateCallback(4)" />
                             </div>
                         </form>
                     </ng-template>
                 </p-step-panel>

                 <p-step-panel [value]="4">
                     <ng-template #content let-activateCallback="activateCallback">

                         <div class="text-white">
                             <div class="max-w-4xl mx-auto p-8">
                                 <header class="flex items-center justify-between mb-10">
                                     <h1 class="text-3xl font-bold text-gray-100">Resumo da Inscrição</h1>
                                     <button icon="pi pi-save" (click)="submit(empresaForm)" [loading]="loading"
                                         [disabled]="!empresaForm.valid" pButton pRipple label="Confirmar e Guardar"
                                         class="w-auto"></button>
                                 </header>
                                 <main>
                                     <section class="bg-gray-800 p-8 rounded-2xl shadow-lg mb-8">
                                         <div class="flex items-center mb-6">
                                             <i class="bi bi-buildings mr-4" style="font-size: 2rem"></i>
                                             <h2 class="text-2xl font-semibold text-gray-200">Dados da Empresa</h2>
                                         </div>
                                         <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                                             <div>
                                                 <p class="text-sm text-gray-400">Nome da Empresa:</p>
                                                 <p class="text-lg text-gray-100">{{ empresaForm.get('nome')?.value }}
                                                 </p>
                                             </div>
                                             <div>
                                                 <p class="text-sm text-gray-400">NIF:</p>
                                                 <p class="text-lg text-gray-100">{{ empresaForm.get('nif')?.value }}
                                                 </p>
                                             </div>
                                             <div>
                                                 <p class="text-sm text-gray-400">Telefone:</p>
                                                 <p class="text-lg text-gray-100">
                                                     {{ empresaForm.get('telefone')?.value }}</p>
                                             </div>
                                             <div>
                                                 <p class="text-sm text-gray-400">Capital Social:</p>
                                                 <p class="text-lg text-gray-100">
                                                     {{ empresaForm.get('capitalSocial')?.value }}</p>
                                             </div>
                                             <div>
                                                 <p class="text-sm text-gray-400">Data de Registo:</p>
                                                 <p class="text-lg text-gray-100">
                                                     {{ empresaForm.get('dataRegisto')?.value | date: 'dd MMMM yyyy' :'':'pt'}}
                                                 </p>
                                             </div>
                                             <div>
                                                 <p class="text-sm text-gray-400">Tipo de Propriedade:</p>
                                                 <p class="text-lg text-gray-100">
                                                     {{ empresaForm.get('tipoPropriedade')?.value.name }}</p>
                                             </div>
                                             <div class="md:col-span-2">
                                                 <p class="text-sm text-gray-400">Localização:</p>
                                                 <p class="text-lg text-gray-100">
                                                     {{ empresaForm.get('sede')?.value }},
                                                     {{ empresaForm.get('aldeia')?.value.nome }},
                                                     {{ empresaForm.get('suco')?.value }},
                                                     {{ empresaForm.get('postoAdministrativo')?.value }},
                                                     {{ empresaForm.get('municipio')?.value }}
                                                 </p>
                                             </div>
                                         </div>
                                     </section>
                                     <section class="bg-gray-800 p-8 rounded-2xl shadow-lg">
                                         <div class="flex items-center mb-6">
                                             <i class="pi pi-users  mr-4" style="font-size: 2rem"></i>
                                             <h2 class="text-2xl font-semibold text-gray-200">Acionistas</h2>
                                         </div>
                                         <div>
                                             @for (a of empresaForm.get('acionistas')?.value; track $index) {
                                             <h3 class="text-xl font-medium text-gray-300 mb-4">
                                                 Acionista&nbsp;{{ $index + 1 }}
                                             </h3>
                                             <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 mb-6 ml-4">
                                                 <div>
                                                     <p class="text-sm text-gray-400">Nome:</p>
                                                     <p class="text-lg text-gray-100">{{ a.nome }}</p>
                                                 </div>
                                                 <div>
                                                     <p class="text-sm text-gray-400">NIF:</p>
                                                     <p class="text-lg text-gray-100">{{ a.nif }}</p>
                                                 </div>
                                                 <div>
                                                     <p class="text-sm text-gray-400">Documento:</p>
                                                     <p class="text-lg text-gray-100">{{ a.tipoDocumento.name }} –
                                                         {{ a.numeroDocumento }}
                                                     </p>
                                                 </div>
                                                 <div>
                                                     <p class="text-sm text-gray-400">Contacto:</p>
                                                     <p class="text-lg text-gray-100">{{ a.telefone }} / {{ a.email }}
                                                     </p>
                                                 </div>
                                                 <div>
                                                     <p class="text-sm text-gray-400">Ações:</p>
                                                     <p class="text-lg text-gray-100">{{ a.acoes }}</p>
                                                 </div>
                                             </div>
                                             }
                                         </div>
                                     </section>
                                     <section class="bg-gray-800 p-8 rounded-2xl shadow-lg mb-8">
                                         <div class="flex items-center mb-6">
                                             <i class="bi bi-person-vcard mr-4" style="font-size: 2rem"></i>
                                             <h2 class="text-2xl font-semibold text-gray-200">Gerente/Conta de acesso
                                             </h2>
                                         </div>
                                         <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                                             <div>
                                                 <p class="text-sm text-gray-400">Gerente:</p>
                                                 <p class="text-lg text-gray-100">
                                                     {{ empresaForm.get('utilizador.gerente')?.value }}
                                                 </p>
                                             </div>
                                             <div>
                                                 <p class="text-sm text-gray-400">Email:</p>
                                                 <p class="text-lg text-gray-100">
                                                     {{ empresaForm.get('utilizador.email')?.value }}
                                                 </p>
                                             </div>
                                         </div>
                                     </section>
                                     <div class="mt-6 mb-6 text-left flex justify-between items-center">
                                         <p-button label="Back" severity="secondary" icon="pi pi-arrow-left"
                                             iconPos="left" (onClick)="activateCallback(2)" />
                                         <button icon="pi pi-save" (click)="submit(empresaForm)" [loading]="loading"
                                             [disabled]="!empresaForm.valid" pButton pRipple label="Confirmar e Guardar"
                                             class="w-auto"></button>
                                     </div>
                                 </main>
                             </div>

                         </div>
                     </ng-template>
                 </p-step-panel>
             </p-step-panels>
         </p-stepper>
         <div class="px-12">
             @if (isError) {
             <div class="mb-4">
                 <p-message severity="error">
                     <ng-template #icon>
                         <i class="bi bi-x-circle" style="font-size: 1.5rem"></i> &nbsp;
                     </ng-template>
                     <span class="ml-2 text-lg">
                         Ocorreu um erro. Por favor, tente novamente ou contacte o administrador do sistema.
                     </span>
                 </p-message>
             </div>
             }
             <!-- <div class="flex items-center my-6">
                 <div class="flex items-center pr-6 mr-6 border-r border-surface-200 dark:border-surface-700">
                     <h4>
                         Ministério de Comércio e Indústria
                     </h4>
                 </div>
                 <span class="text-sm text-surface-500 dark:text-surface-400 mr-4">Copyright 2025</span>
             </div> -->
         </div>
     </div>
 </div>
 } @else {
 <div class="w-full" style="background: var(--surface-ground)">
     <p-fluid
         class="min-h-screen text-center w-full flex items-center md:items-start justify-start flex-col bg-auto md:bg-contain !bg-no-repeat"
         style="padding: 10% 10% 20% 10%; background: var(--exception-pages-image); background-size: contain;">
         <div class="flex flex-col">
             <div class="flex items-center justify-center">
                 <img src="/images/logo.png" style="width: 100px" alt="logo" />
             </div>
             <div class="mt-2 mb-8">
                 <p class="text-xl">
                     Trade License Management System
                 </p>
             </div>
             @if (notification) {
             <p-message [severity]="notification.state">
                 <ng-template #icon>
                     <i [class]="notification.icon" style="font-size: 1.5rem"></i> &nbsp;
                 </ng-template>
                 <span class="ml-2 text-lg">
                     {{ notification.message }}
                 </span>
             </p-message>
             }
             <div class="mt-6 text-center flex items-center justify-center flex-col gap-4">
                 <button icon="pi pi-send" (click)="submit(empresaForm)" [loading]="loading"
                     [disabled]="empresaForm.valid" pButton label="Reenviar email" style="max-width:200px">
                 </button>
                 <button icon="pi pi-sign-in" pButton label="Logar" style="max-width:200px" routerLink="/auth/login"
                     [rounded]="true" [outlined]="true">
                 </button>
             </div>

         </div>

         <div class="flex items-center absolute" style="bottom: 75px">
             <div class="flex items-center pr-6 mr-6 border-r border-surface-200 dark:border-surface-700">
                 <h4>
                     Ministério de Comércio e Indústria
                 </h4>
             </div>
             <span class="text-sm text-surface-500 dark:text-surface-400 mr-4">Copyright 2025</span>
         </div>
     </p-fluid>
 </div>
 }