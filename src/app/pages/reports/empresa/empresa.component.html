<div class="card">
    <form [formGroup]="reportForm" (ngSubmit)="onSubmit()" class="py-4">
        <div class="grid grid-cols-3 gap-4">
            <div class="mb-6 col-span-3 md:col-span-1">
                <label for="sociedadeComercial" class="font-medium  mb-2 block">
                    Tipo de Propriedade
                </label>
                <p-select fluid formControlName="tipoPropriedade" [options]="listaTipoPropriedade" optionLabel="name"
                    optionValue="value" placeholder="Selecione o tipo de propriedade" [showClear]="true">
                </p-select>
            </div>
            <div class="mb-6 col-span-3 md:col-span-1">
                <label for="sociedadeComercial" class="font-medium  mb-2 block">
                    Tipo de Sociedade Comercial
                </label>
                <p-select fluid formControlName="sociedadeComercialId" [options]="listaSociedadeComercial"
                    optionLabel="name" optionValue="value" placeholder="Selecione o tipo de sociedade"
                    [showClear]="true">
                </p-select>
            </div>
            <div class="mb-6 col-span-3 md:col-span-1">
                <label for="tipoEmpresa" class="font-medium  mb-2 block">
                    Tipo da Empresa
                </label>
                <p-select fluid formControlName="tipoEmpresa" [options]="listaTipoEmpresa" optionLabel="name"
                    optionValue="value" placeholder="Selecione o tipo de empresa" [showClear]="true">
                </p-select>
            </div>
        </div>
        <div class="grid grid-cols-3 gap-4">
            <div class="mb-6 col-span-3 md:col-span-1">
                <label for="municipioId" class="font-medium  mb-2 block">
                    Municipio
                </label>
                <p-select fluid formControlName="municipioId" [options]="listaMunicipios" optionLabel="name"
                    optionValue="value" placeholder="Selecione o municipio" [showClear]="true">
                </p-select>
            </div>
            <div class="mb-6 col-span-3 md:col-span-1">
                <label for="postoAdministrativoId" class="font-medium  mb-2 block">
                    Posto Administrativo
                </label>
                <p-select fluid formControlName="postoAdministrativoId" [options]="listaPostosAdministrativos"
                    optionLabel="name" optionValue="value" placeholder="Selecione o posto administrativo"
                    [showClear]="true">
                </p-select>
            </div>
            <div class="mb-6 col-span-3 md:col-span-1">
                <label for="sucoId" class="font-medium  mb-2 block">
                    Suco
                </label>
                <p-select fluid formControlName="sucoId" [options]="listaSucos" optionLabel="name" optionValue="value"
                    placeholder="Selecione o suco" [showClear]="true">
                </p-select>
            </div>
        </div>
        <div class="grid grid-cols-1">
            <div class="col-span-1">
                <p-button icon="pi pi-sync" (click)="onSubmit()" [loading]="dataIsFetching"
                    [disabled]="isFormEmpty(reportForm)" pRipple label="Gerar Relatório" class="w-auto">
                </p-button>
                <p-button class="ml-4" (onClick)="clearFilter()" label="Clear" icon="pi pi-trash" [raised]="true"
                    severity="secondary" />
            </div>
        </div>
    </form>

    @if (data.length > 0) {
    <div class="flex justify-between">
        <h1 class="text-2xl font-bold text-white pt-6">
            Filtered Results
        </h1>
        <p-button (onClick)="exportToExcel()" [disabled]="isFormEmpty(reportForm) || data.length === 0"
            label="Export to Excel" icon="pi pi-file-excel" [raised]="true" severity="success" class="mr-2" />
    </div>
    <p-table #dt [value]="data" responsiveLayout="scroll" [scrollable]="true" [rowHover]="true">
        <ng-template #header>
            <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Local</th>
                <th>Tipo Propriedade</th>
                <th>Tipo Sociedade Comercial</th>
                <th>Tipo Empresa</th>
                <th>Gerente</th>
                <th>Telefone</th>
                <th>Registo em</th>
            </tr>
        </ng-template>
        <ng-template #body let-empresa>
            <tr>
                <td>
                    {{ empresa.nome }}
                </td>
                <td>
                    {{empresa.utilizador.email}}
                </td>
                <td>
                    {{empresa.sede.local}} - {{empresa.sede.aldeia.suco.postoAdministrativo.municipio.nome}}
                </td>
                <td>
                    {{empresa.tipoPropriedade}}
                </td>
                <td>
                    {{empresa.sociedadeComercial.nome}}
                </td>
                <td>
                    {{empresa.tipoEmpresa}}
                </td>
                <td>
                    {{empresa.gerente.nome}}
                </td>
                <td>
                    {{empresa.telefone}}
                </td>
                <td>
                    {{ empresa.createdAt | date: 'MM/dd/yyyy, HH:mm:ss' }}
                </td>
            </tr>
        </ng-template>
    </p-table>
    <p-paginator (onPageChange)="onPageChange($event)" [rows]="size" [totalRecords]="totalData"
        [rowsPerPageOptions]="[50, 250, 500, 1000]" [showCurrentPageReport]="true"
        currentPageReportTemplate="A mostrar {first} até {last} de {totalRecords}" />
    }
    @else {
    @for (message of messages(); track message; let first = $first) {
    <p-message [icon]="message.icon" [size]="message.size" [severity]="message.severity" [text]="message.content" />
    }
    }
</div>